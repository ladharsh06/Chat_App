{"ast":null,"code":"import React from 'react';\nfunction _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  _setPrototypeOf(subClass, superClass);\n}\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n  return self;\n}\nvar W3CWebSocket = require('websocket').w3cwebsocket;\nvar WebSocket = /*#__PURE__*/function (_React$Component) {\n  _inheritsLoose(WebSocket, _React$Component);\n  function WebSocket(props) {\n    var _this;\n    _this = _React$Component.call(this, props) || this;\n    _this.state = {\n      ws: new W3CWebSocket(_this.props.url),\n      attempts: 1\n    };\n    _this.sendMessage = _this.sendMessage.bind(_assertThisInitialized(_this));\n    _this.setupWebsocket = _this.setupWebsocket.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n  var _proto = WebSocket.prototype;\n  _proto.logging = function logging(logline) {\n    if (this.props.debug === true) {\n      console.log(logline);\n    }\n  };\n  _proto.generateInterval = function generateInterval(k) {\n    if (this.props.reconnectIntervalInMilliSeconds > 0) {\n      return this.props.reconnectIntervalInMilliSeconds;\n    }\n    return Math.min(30, Math.pow(2, k) - 1) * 1000;\n  };\n  _proto.setupWebsocket = function setupWebsocket() {\n    var _this2 = this;\n    var websocket = this.state.ws;\n    websocket.onopen = function () {\n      _this2.logging('Websocket connected...');\n      if (typeof _this2.props.onOpen === 'function') _this2.props.onOpen();\n    };\n    websocket.onerror = function (e) {\n      if (typeof _this2.props.onError === 'function') _this2.props.onError(e);\n    };\n    websocket.onmessage = function (evt) {\n      _this2.props.onMessage(evt.data);\n    };\n    this.shouldReconnect = this.props.reconnect;\n    websocket.onclose = function (evt) {\n      _this2.logging(\"Websocket disconnected,the reason: \" + evt.reason + \",the code: \" + evt.code);\n      if (typeof _this2.props.onClose === 'function') _this2.props.onClose(evt.code, evt.reason);\n      if (_this2.shouldReconnect) {\n        var time = _this2.generateInterval(_this2.state.attempts);\n        _this2.timeoutID = setTimeout(function () {\n          _this2.setState({\n            attempts: _this2.state.attempts + 1\n          });\n          _this2.setState({\n            ws: new W3CWebSocket(_this2.props.url)\n          });\n          _this2.setupWebsocket();\n        }, time);\n      }\n    };\n  };\n  _proto.componentDidMount = function componentDidMount() {\n    var childRef = this.props.childRef;\n    childRef && childRef(this);\n    this.setupWebsocket();\n  };\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    var childRef = this.props.childRef;\n    childRef && childRef(undefined);\n    this.shouldReconnect = false;\n    clearTimeout(this.timeoutID);\n    var websocket = this.state.ws;\n    websocket.close();\n  };\n  _proto.sendMessage = function sendMessage(message) {\n    var websocket = this.state.ws;\n    websocket.send(message);\n  };\n  _proto.render = function render() {\n    return /*#__PURE__*/React.createElement(\"div\", null);\n  };\n  return WebSocket;\n}(React.Component);\nexport { WebSocket };","map":{"version":3,"names":["W3CWebSocket","require","w3cwebsocket","WebSocket","_React$Component","props","_this","call","state","ws","url","attempts","sendMessage","bind","_assertThisInitialized","setupWebsocket","logging","logline","debug","console","log","generateInterval","k","reconnectIntervalInMilliSeconds","Math","min","pow","_this2","websocket","onopen","onOpen","onerror","e","onError","onmessage","evt","onMessage","data","shouldReconnect","reconnect","onclose","reason","code","onClose","time","timeoutID","setTimeout","setState","componentDidMount","childRef","componentWillUnmount","undefined","clearTimeout","close","message","send","render","React","createElement","Component"],"sources":["D:\\Chat_App\\node_modules\\nextjs-websocket\\src\\index.js"],"sourcesContent":["import React from 'react'\n\nvar W3CWebSocket = require('websocket').w3cwebsocket;\n\nclass WebSocket extends React.Component {constructor(props) {\n  super(props);\n    this.state = {\n      ws: new W3CWebSocket(this.props.url),\n      attempts: 1\n    };\n    this.sendMessage = this.sendMessage.bind(this);\n    this.setupWebsocket = this.setupWebsocket.bind(this);\n  }\n\n  logging(logline) {\n    if (this.props.debug === true) {\n      console.log(logline);\n    }\n  }\n\n  generateInterval(k) {\n    if (this.props.reconnectIntervalInMilliSeconds > 0) {\n      return this.props.reconnectIntervalInMilliSeconds;\n    }\n    return Math.min(30, Math.pow(2, k) - 1) * 1000;\n  }\n\n  setupWebsocket() {\n    let websocket = this.state.ws;\n\n    websocket.onopen = () => {\n      this.logging('Websocket connected...');\n      if (typeof this.props.onOpen === 'function') this.props.onOpen();\n    };\n\n    websocket.onerror = e => {\n      if (typeof this.props.onError === 'function') this.props.onError(e);\n    };\n\n    websocket.onmessage = evt => {\n      this.props.onMessage(evt.data);\n    };\n\n    this.shouldReconnect = this.props.reconnect;\n    websocket.onclose = evt => {\n      this.logging(\n        `Websocket disconnected,the reason: ${evt.reason},the code: ${evt.code}`\n      );\n      if (typeof this.props.onClose === 'function')\n        this.props.onClose(evt.code, evt.reason);\n      if (this.shouldReconnect) {\n        let time = this.generateInterval(this.state.attempts);\n        this.timeoutID = setTimeout(() => {\n          this.setState({ attempts: this.state.attempts + 1 });\n          this.setState({ ws: new W3CWebSocket(this.props.url) });\n          this.setupWebsocket();\n        }, time);\n      }\n    };\n  }\n\n  componentDidMount() {\n    const { childRef } = this.props;\n    childRef && childRef(this);\n\n    this.setupWebsocket();\n  }\n\n  componentWillUnmount() {\n    const { childRef } = this.props;\n    childRef && childRef(undefined);\n\n    this.shouldReconnect = false;\n    clearTimeout(this.timeoutID);\n\n    let websocket = this.state.ws;\n    websocket.close();\n  }\n\n  sendMessage(message) {\n    let websocket = this.state.ws;\n    websocket.send(message);\n  }\n\n  render() {\n    return <div></div>;\n  }\n}\n\nexport {\n  WebSocket\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}